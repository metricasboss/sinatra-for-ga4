___TERMS_OF_SERVICE___

By creating or modifying this file you agree to Google Tag Manager's Community
Template Gallery Developer Terms of Service available at
https://developers.google.com/tag-manager/gallery-tos (or such other URL as
Google may provide), as modified from time to time.


___INFO___

{
  "type": "TAG",
  "id": "cvt_temp_public_id",
  "version": 1,
  "securityGroups": [],
  "displayName": "Sinatra for Google Analytics 4",
  "brand": {
    "id": "brand_dummy",
    "displayName": "Métricas Boss",
    "thumbnail": "data:image/png;base64,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"
  },
  "description": "Clone Google Analytics 4 events to another server",
  "containerContexts": [
    "WEB"
  ]
}


___TEMPLATE_PARAMETERS___

[
  {
    "type": "TEXT",
    "name": "account_id",
    "displayName": "Account Id",
    "simpleValueType": true
  },
  {
    "type": "GROUP",
    "name": "advanced_settings",
    "displayName": "Sinatra Advanced Settings",
    "groupStyle": "ZIPPY_CLOSED",
    "subParams": [
      {
        "type": "TEXT",
        "name": "server_container_url",
        "displayName": "Server container url",
        "simpleValueType": true
      }
    ]
  }
]


___SANDBOXED_JS_FOR_WEB_TEMPLATE___

// Importa as APIs necessárias do template
const addEventCallback = require('addEventCallback');
const sendPixel = require('sendPixel');
const JSON = require('JSON');
const encodeUriComponent = require('encodeUriComponent');
const logToConsole = require("logToConsole");

// Registra um callback para ser executado ao final de cada evento
addEventCallback(function(containerId, eventData) {
  // Exibe informações de debug no console (opcional)
  logToConsole("Evento interceptado no container " + containerId + ":", eventData);
  
  // Converte os dados do evento para uma string JSON
  var eventString = JSON.stringify(eventData);
  
  // Codifica a string para que possa ser enviada na URL
  var encodedData = encodeUriComponent(eventString);
  
  // Define a URL base (usando o valor do campo advanced_config ou um valor padrão)
  var baseUrl = data.advanced_settings.server_container_url || "https://webhook.site/544350b1-b6f5-48bb-bdec-7a84d14ee695";
  
  // Monta a URL de destino com o webhook e adiciona o parâmetro accountId, se existir
  var pixelUrl = baseUrl + "?event=" + encodedData + (data.accountId ? "&accountId=" + data.accountId : "");
  
  // Envia os dados do evento via pixel (requisição GET)
  sendPixel(pixelUrl);
  data.gtmOnSuccess();
});


___WEB_PERMISSIONS___

[
  {
    "instance": {
      "key": {
        "publicId": "logging",
        "versionId": "1"
      },
      "param": [
        {
          "key": "environments",
          "value": {
            "type": 1,
            "string": "debug"
          }
        }
      ]
    },
    "clientAnnotations": {
      "isEditedByUser": true
    },
    "isRequired": true
  },
  {
    "instance": {
      "key": {
        "publicId": "read_event_metadata",
        "versionId": "1"
      },
      "param": []
    },
    "isRequired": true
  },
  {
    "instance": {
      "key": {
        "publicId": "send_pixel",
        "versionId": "1"
      },
      "param": [
        {
          "key": "allowedUrls",
          "value": {
            "type": 1,
            "string": "specific"
          }
        }
      ]
    },
    "isRequired": true
  }
]


___TESTS___

scenarios: []


___NOTES___

Created on 3/13/2025, 6:48:56 PM


